<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>대시보드 개발</title>

    <style>
      div {
        margin: 0;
      }

      .patternLabel {
        float: left;
      }

      .bar {
      }

      .highlight {
        fill: orange;
      }

      .axis--y .tick:first-of-type > text {
        display: none;
      }

      .tick line {
        opacity: 0.1;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: white;
        stroke-width: 1;
        shape-rendering: crispEdges;
      }

      .c3-tooltip-container {
        position: absolute;
        pointer-events: none;
        z-index: 10;
      }

      .c3-tooltip {
        border-collapse: collapse;
        border-spacing: 0;
        empty-cells: show;
        -webkit-box-shadow: 7px 7px 12px -9px #777777;
        -moz-box-shadow: 7px 7px 12px -9px #777777;
        box-shadow: 7px 7px 12px -9px #777777;
        opacity: 0.9;
      }

      .c3-tooltip th {
        background-color: rgb(230, 230, 230);
        font-size: 14px;
        padding: 2px 5px;
        text-align: left;
        color: #252525;
      }

      .c3-tooltip td {
        font-size: 13px;
        padding: 3px 6px;
        background-color: #fff;
        text-align: left;
      }

      .c3-tooltip td > span {
        display: inline-block;
        width: 10px;
        height: 10px;
        margin-right: 6px;
      }

      .c3-tooltip td.value {
        text-align: right;
      }

      .grid line {
        stroke: lightgrey;
        stroke-opacity: 0.7;
        shape-rendering: crispEdges;
      }

      .chart-panel-heading {
        color: #333;
        background-color: #e4dcd3 !important;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
      }

      .panel.panel-default {
        min-width: 400px;
        max-width: 600px;
      }

      .panel-body {
        text-align: left;
        display: flex;
      }

      .chart-body {
        height: 450px;
        width: 600px;
        text-align: left;
        display: inline-block;
      }

      .left-margin {
        margin-left: 20px;
      }
      .sub-title {
        margin: 20px 0 20px 20px;
      }
      #pie-test {
        margin: 0 auto;
      }
    </style>
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div id="divContainerCD">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <div class="first-chart-box">
                <div class="sub-title left-margin">
                  <h4>차트 1</h4>
                </div>
                <div
                  id="first-chart"
                  class="chart-body"
                  style="float: left"
                ></div>
              </div>
              <div class="second-chart-box">
                <div class="sub-title left-margin">
                  <h4>차트 2</h4>
                </div>
                <div
                  id="second-chart"
                  class="chart-body"
                  style="float: right"
                ></div>
              </div>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-body">
              <div class="third-chart-box">
                <div class="sub-title left-margin">
                  <h4>차트 3</h4>
                </div>
                <div style="width: 100%; text-align: left; float: left">
                  <input
                    type="checkbox"
                    class="form-check-input left-margin"
                    id="except-year"
                    onclick="updateThirdChart()"
                  />
                  연도 미포함
                </div>
                <div
                  id="third-chart"
                  class="chart-body"
                  style="float: left"
                ></div>
              </div>
              <div class="fourth-chart-box">
                <div class="sub-title left-margin">
                  <h4>차트 4</h4>
                </div>
                <div id="pie-test" class="chart-body" style="float: left"></div>
                <!-- <div id="releasestatus" class="chart-body" style="float: right"></div> -->
              </div>
              </div>
          </div>
          <!-- <div class="panel panel-default">
            <div class="panel-body">
              <div class="releasedcar-box">
                <div class="sub-title left-margin">
                  <h4>차트 5</h4>
                </div>
                <div id="pie-test" class="chart-body" style="float: left"></div>
              </div>
              <div class="releasestatus-box">
                <div></div>
                <div class="chart-body" style="float: right"></div>
              </div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
    <script type="text/javascript">
      $(document).ready(function () {
        $("#divContainerCD").css("height", $(window).height() - 104);
        drawChart("first-chart", null, null);
        drawChart("second-chart", null, null, 2);
        drawChart("third-chart", null);
        // drawChart("releasestatus", null);
        drawPieChart("second-chart", null);
      });

      var width = 0,
        height = 0,
        xScale = 0,
        yScale = 0,
        xGroup = [];

      var tooltip;
      var margin = { top: 20, right: 30, bottom: 10, left: 40 };

      // 데이터를 불러오는 함수
      function loadData(dataType, typeNum) {
        //
      }

      // 데이터가 있을 때 차트를 그리는 함수
      function drawChart(dataType, ChartData, dataForm, typeNum) {
        /*
      datatypearray는 linearray랑 같은 변수임
      */
        // if(ChartData == null)
        //   loadData(dataType);

        if (typeNum == null) typeNum = "";
        $("#" + dataType + typeNum).empty();
        var barColor = d3.scaleOrdinal().range(d3.schemeBlues[5]);
        tooltip = d3
          .select("#" + dataType + typeNum)
          .append("div")
          .attr("class", "c3-tooltip-container");

        var baseWidth = $("#" + dataType + typeNum).width();
        baseWidth = baseWidth > 0 ? baseWidth : 900;
        var baseHeight = $("#" + dataType + typeNum).height() - 20;
        baseHeight = baseHeight > 0 ? baseHeight : 500;
        //여백설정
        var svg = d3
          .select("#" + dataType)
          .append("svg")
          .style("text-align", "center")
          .attr("width", baseWidth - margin.left - margin.right)
          .attr("height", baseHeight - margin.top - margin.bottom);
        width = svg.attr("width") / 2;
        height = svg.attr("height") - 150;

        (xScale = d3
          .scaleBand()
          .range([0, width])
          .paddingInner([0.85])
          .paddingOuter([0.4])),
          (yScale = d3.scaleLinear().range([height, 0]));

        switch (dataType + typeNum) {
          case "first-chart":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");

            // 차트 데이터가 없을 때,
            if (ChartData == null) {
              d3.json("./firstchartdata.json")
                .then(function (data) {
                  // console.log(data.slice(0, 1));
                  xScale.domain(
                    data.map(function (d) {
                      return d.AREA;
                    })
                  );

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(
                      // x축: 틱 사이즈 0은 세로 기준 표기선 삭제 함수
                      d3.axisBottom(xScale).tickSize(0)
                    )
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("transform", "translate(0, 5)rotate(-20)")
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em");

                  yScale.domain([
                    0,
                    d3.max(data, function (d) {
                      return parseInt(d.CNT) % 5 == 0
                        ? parseInt(d.CNT)
                        : parseInt(d.CNT) + (5 - (parseInt(d.CNT) % 5));
                    }),
                  ]);

                  g.append("g")
                    .call(
                      // * 이하 밑부터 왼쪽 y축 라벨링
                      d3
                        .axisLeft(yScale)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .tickSize(0)
                        .ticks(10)
                    )
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "-3em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  // console.log(xScale.domain());
                  xGroup = [];
                  for (var i = 0; i < data.length; i++) {
                    // 각 코드별로 하나의 객체로 묶어주기
                    // typeof xScale.domain()은 object 타입
                    // console.log(index, xScale(data[i].AREA))
                    const index = xScale.domain().indexOf(data[i].AREA);
                    if (xGroup[index] == null) {
                      xGroup[index] = [data[i].id];
                    } else {
                      xGroup[index] = [...xGroup[index], data[i].id];
                    }
                  }
                  var maxY = 0;
                  for (var i = 0; i < xGroup.length; i++) {
                    var sum = 0;
                    for (var j = 0; j < xGroup[i].length; j++) {
                      sum += parseInt(data[xGroup[i][j] - 1].CNT);
                    }
                    maxY = Math.max(maxY, sum);
                  }

                  // * line
                  var y1 = d3
                    .scaleLinear()
                    .range([height, 0])
                    .domain([0, maxY + 10]);
                  var line = d3
                    .line()
                    // .curve(d3.curveMonotoneX)
                    .x(function (d) {
                      return xScale(d.AREA) + 10;
                    })
                    .y(function (d) {
                      var avg = 0;
                      for (
                        var i = 0;
                        i < xGroup[xScale.domain().indexOf(d.AREA)].length;
                        i++
                      ) {
                        const idx =
                          parseInt(xGroup[xScale.domain().indexOf(d.AREA)][i]) -
                          1;
                        if (data[idx] == null) continue;
                        avg += parseInt(data[idx].CNT);
                      }
                      // avg = avg / xGroup[xScale.domain().indexOf(d.AREA)].length;
                      return y1(avg);
                    })
                    .defined(function (d) {
                      return d.DATATYPE;
                    });

                  g.append("g")
                    .call(
                      // * 이하 밑부터 오른쪽 y축 라벨링
                      d3
                        .axisRight(y1)
                        .tickSize(width)
                        // .tickFormat()
                        .ticks(5)
                    )

                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "30em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "steelblue")
                    .text("합계");

                  // * bar
                  g.selectAll(".bar")
                    .data(data, function (d) {
                      return d.id;
                    })
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver) //Add listener for the mouseover event
                    .on("mouseout", onMouseOut) //Add listener for the mouseout event
                    .attr("x", function (d) {
                      // var len = d3.scaleBand().domain(data).range([0, width]);
                      // console.log(len, xScale(d.AREA)+d.id*5)
                      // console.log(d3.scaleBand().domain(data)(d));
                      return (
                        xScale(d.AREA) +
                        (xGroup[xScale.domain().indexOf(d.AREA)].indexOf(d.id) -
                          xGroup[xScale.domain().indexOf(d.AREA)].length / 2) *
                          25 +
                        10
                      );
                    })
                    .attr("y", function (d) {
                      return yScale(d.CNT);
                    })
                    .attr("width", xScale.bandwidth())
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("height", function (d) {
                      return height - yScale(d.CNT);
                    })
                    .attr("fill", function (d) {
                      // console.log(xGroup);
                      return barColor(
                        xGroup[xScale.domain().indexOf(d.AREA)].indexOf(d.id)
                      );
                    });

                  // 라인 그리기
                  g.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line)
                    .style("fill", "none")
                    .style("stroke", barColor(4))
                    .attr("stroke-width", 2);

                  console.log(xGroup);
                  // 라인 위에 그려지는 점
                  g.selectAll("dot")
                    .data(xGroup)
                    .enter()
                    .append("circle")
                    .attr("r", function (d) {
                      return 4;
                    })
                    .attr("cx", function (d) {
                      return xScale(data[parseInt(d[0]) - 1].AREA) + 10;
                    })
                    .attr("cy", function (d) {
                      var avg = 0;
                      for (var i = 0; i < d.length; i++) {
                        const idx = parseInt(d[i]) - 1;
                        avg += parseInt(data[idx].CNT);
                      }
                      // avg = avg / xGroup[xScale.domain().indexOf(d.AREA)].length;
                      return y1(avg);
                    })
                    .style("fill", barColor(4))
                    .on("mouseover", onMouseOver)
                    .on("mouseout", onMouseOut);
                })
                .catch((e) => console.log(e));
            }
            break;
          // * 동기화 건수 그래프
          case "second-chart":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");

            // 차트 데이터가 없을 때,
            if (ChartData == null) {
              d3.json("./secondchartdata.json")
                .then(function (data) {
                  // console.log(data.slice(0, 1));
                  xScale.domain(
                    data.map(function (d) {
                      return d.id;
                    })
                  );
                  yScale.domain([
                    0,
                    Math.max.apply(
                      Math,
                      data.map(function (d) {
                        return d.CNT;
                      })
                    ) + 5,
                  ]);

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(
                      // x축: 틱 사이즈 0은 세로 기준 표기선 삭제 함수
                      d3.axisBottom(xScale).tickSize(0)
                    )
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("transform", "translate(0, 5)rotate(-20)")
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 오른쪽 y축 라벨링
                      d3
                        .axisRight(yScale)
                        .tickSize(baseWidth / 2)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(10)
                    )
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "45em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 왼쪽 y축 라벨링
                      d3
                        .axisLeft(yScale)
                        .tickSize(0)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(10)
                    )
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "-5em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  // console.log(xScale.domain());
                  // var xGroup = [];
                  // for (var i = 0; i < data.length; i++) {
                  //   // 각 코드별로 하나의 객체로 묶어주기
                  //   // typeof xScale.domain()은 object 타입
                  //   // console.log(index, xScale(data[i].AREA))
                  //   const index = xScale.domain().indexOf(data[i].AREA);
                  //   if (xGroup[index] == null) {
                  //     xGroup[index] = [data[i].id];
                  //   } else {
                  //     xGroup[index] = [...xGroup[index], data[i].id];
                  //   }
                  // }

                  // * bar
                  g.selectAll(".bar")
                    .data(data, function (d) {
                      return d.id;
                    })
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    // .on("mouseover", onMouseOver) //Add listener for the mouseover event
                    // .on("mouseout", onMouseOut) //Add listener for the mouseout event
                    .attr("x", function (d) {
                      // var len = d3.scaleBand().domain(data).range([0, width]);
                      // console.log(len, xScale(d.AREA)+d.id*5)
                      // console.log(d3.scaleBand().domain(data)(d));
                      // return (
                      //   xScale(d.AREA) +
                      //   (xGroup[xScale.domain().indexOf(d.AREA)].indexOf(
                      //     d.id
                      //   ) -
                      //     xGroup[xScale.domain().indexOf(d.AREA)].length / 2)
                      // )
                      return xScale(d.id);
                    })
                    .attr("y", function (d) {
                      return yScale(d.CNT);
                    })
                    .attr("width", xScale.bandwidth())
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("height", function (d) {
                      return height - yScale(d.CNT);
                    })
                    .attr("fill", function (d) {
                      return barColor(d.id);
                    });
                })
                .catch((e) => console.log(e));
            }
            break;
          case "second-chart2":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");

            // 차트 데이터가 없을 때,
            if (ChartData == null) {
              d3.json("./secondchartdata.json")
                .then(function (data) {
                  var x = d3
                      .scaleLinear()
                      .domain([
                        0,
                        Math.max.apply(
                          Math,
                          data.map(function (d) {
                            return d.CNT;
                          })
                        ) + 5,
                      ])
                      .range([0, width]),
                    y = d3
                      .scaleBand()
                      .range([0, height])
                      .domain(
                        data.map(function (d) {
                          return d.YYYY + " " + d.MM + " " + d.TYPE;
                        })
                      )
                      .paddingInner([0.3])
                      .paddingOuter([0.9]);

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).tickSize(0))
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em")
                    .style("text-anchor", "end");

                  g.append("g").call(
                    // * 이하 밑부터 왼쪽 y축 라벨링
                    d3
                      .axisLeft(y)
                      .tickSize(0)
                      .tickFormat(function (d) {
                        return d;
                      })
                  );

                  // * bar
                  g.selectAll(".bar")
                    .data(data, function (d) {
                      return d.YYYY + " " + d.MM + " " + d.TYPE;
                    })
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver) //Add listener for the mouseover event
                    .on("mouseout", onMouseOut) //Add listener for the mouseout event
                    .attr("x", x(0) + 1)
                    .attr("y", function (d) {
                      return y(d.YYYY + " " + d.MM + " " + d.TYPE);
                    })
                    .attr("width", function (d) {
                      return x(d.CNT);
                    })
                    .attr("height", y.bandwidth())
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("fill", function (d) {
                      return barColor(d.id);
                    });
                })
                .catch((e) => console.log(e));
            }
            break;
          case "first-chart2":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");

            // 차트 데이터가 없을 때,
            if (ChartData == null) {
              d3.json("./expectedsucessfaileddata.json")
                .then(function (data) {
                  xScale.domain(
                    data.map(function (d) {
                      return d.id;
                    })
                  );
                  yScale.domain([
                    0,
                    d3.max(data, function (d) {
                      return parseInt(d.CNT) % 5 == 0
                        ? parseInt(d.CNT)
                        : parseInt(d.CNT) + (5 - (parseInt(d.CNT) % 5));
                    }) + 10,
                  ]);

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(
                      // x축: 틱 사이즈 0은 세로 기준 표기선 삭제 함수
                      d3.axisBottom(xScale).tickSize(-height)
                    )
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("transform", "translate(0, 5)rotate(-20)")
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 왼쪽 y축 라벨링
                      d3
                        .axisLeft(yScale)
                        .tickSize(-width)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(10)
                    )
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "-5em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 오른쪽 y축 라벨링
                      d3
                        .axisRight(yScale)
                        .tickSize(baseWidth / 2 - 35)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(5)
                    )
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "40em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "steelblue")
                    .text("건수");

                  // * bar
                  g.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver) //Add listener for the mouseover event
                    .on("mouseout", onMouseOut) //Add listener for the mouseout event
                    .attr("x", function (d) {
                      return xScale(d.id);
                    })
                    .attr("y", function (d) {
                      return yScale(d.CNT);
                    })
                    .attr("width", (width = xScale.bandwidth()))
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("height", function (d) {
                      return height - yScale(d.CNT);
                    })
                    .attr("fill", function (d) {
                      // console.log(xGroup);
                      return barColor(d.id);
                    });

                  // * line
                  var line = d3
                    .line()
                    .x(function (d) {
                      return xScale(d.id) + 10;
                    })
                    .y(function (d) {
                      return yScale(d.CNT) - 20;
                    })
                    .defined(function (d) {
                      return d.DATATYPE;
                    });

                  g.append("path")
                    .datum(data)
                    .on("mouseover", onMouseOver)
                    .on("mouseout", onMouseOut)
                    .attr("class", "line")
                    .attr("d", line)
                    .style("fill", "none")
                    .style("stroke", barColor(4))
                    .attr("stroke-width", 2);

                  g.selectAll("dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("r", function (d) {
                      return 3;
                    })
                    .attr("cx", function (d) {
                      return xScale(d.id) + 3;
                    })
                    .attr("cy", function (d) {
                      return yScale(d.CNT) - 20;
                    })
                    .style("fill", barColor(4));
                })
                .catch((e) => console.log(e));
            }
            break;

          case "third-chart":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");

            if (ChartData == null) {
              d3.json("./thirdchartdata.json")
                .then(function (data) {
                  xScale
                    .domain(
                      data.map(function (d) {
                        if (dataForm == "none") {
                          return d.MODELCODE;
                        }
                        return d.MODELCODE + " " + d.MODELYR + "년";
                      })
                    )
                    .paddingInner([0.4])
                    .paddingOuter([0.9]);

                  xGroup = [];
                  for (var i = 0; i < data.length; i++) {
                    var index = xScale
                      .domain()
                      .indexOf(data[i].MODELCODE + " " + data[i].MODELYR + "년");
                    if (dataForm == "none")
                      index = xScale.domain().indexOf(data[i].MODELCODE);
                    if (xGroup[index] == null) {
                      xGroup[index] = [data[i]];
                    } else {
                      xGroup[index] = [...xGroup[index], data[i]];
                    }
                  }

                  yScale.domain([
                    0,
                    d3.max(xGroup, function (eleX) {
                      var max = 0;
                      for (var i = 0; i < eleX.length; i++) {
                        max += parseInt(eleX[i].CNT);
                      }
                      return max + (max % 5) + 1;
                    }),
                  ]);

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(
                      // x축: 틱 사이즈 0은 세로 기준 표기선 삭제 함수
                      d3.axisBottom(xScale).tickSize(-height)
                    )
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("transform", "translate(0, 5)rotate(-20)")
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 왼쪽 y축 라벨링
                      d3
                        .axisLeft(yScale)
                        .tickSize(-(baseWidth / 2) + 35)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(5)
                    )
                    // y축 라벨링에 관한 라벨링
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "-5em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  // g.append("g")
                  //   .call(
                  //     // * 이하 밑부터 오른쪽 y축 라벨링
                  //     d3
                  //       .axisRight(yScale)
                  //       .tickSize(baseWidth / 2 - 35)
                  //       .tickFormat(function (d) {
                  //         return d;
                  //       })
                  //       .ticks(5)
                  //   )
                  //   // y축 라벨링 텍스트에 관한 속성들
                  //   .append("text")
                  //   .attr("transform", "rotate(0)")
                  //   .attr("x", height - 300)
                  //   .attr("y", 6)
                  //   .attr("dy", "-2.1em")
                  //   .attr("dx", "45em")
                  //   .attr("text-anchor", "end")
                  //   .attr("stroke", "steelblue")
                  //   .text("평균");

                  // * bar
                  g.selectAll(".bar")
                    .data(xGroup)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .on("mouseover", onMouseOver)
                    .on("mouseout", onMouseOut)
                    .attr("x", function (eleX) {
                      if (dataForm == "none") {
                        return xScale(eleX[0].MODELCODE);
                      }
                      return xScale(eleX[0].MODELCODE + " " + eleX[0].MODELYR+"년");
                    })
                    .attr("y", function (eleX) {
                      // console.log(eleX[0].CNT)
                      if (eleX.length > 1) {
                        var sum = 0;
                        for (var i = 0; i < eleX.length; i++) {
                          sum += parseInt(eleX[i].CNT);
                        }
                        return yScale(sum);
                      }
                      return yScale(eleX[0].CNT);
                    })
                    .attr("width", (width = xScale.bandwidth()))
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("height", function (eleX) {
                      if (eleX.length > 1) {
                        var sum = 0;
                        for (var i = 0; i < eleX.length; i++) {
                          sum += parseInt(eleX[i].CNT);
                        }
                        return height - yScale(sum);
                      }
                      return height - yScale(eleX[0].CNT);
                    })
                    .attr("fill", function (eleX) {
                      // console.log(xGroup);
                      return barColor(data.indexOf(eleX[0]));
                    });
                })
                .catch((e) => console.log(e));
            }
            break;

          case "fourth-chart":
            var g = svg
              .append("g")
              .attr("transform", "translate(" + 100 + "," + 100 + ")");
            // 차트 데이터가 없을 때,
            if (ChartData == null) {
              d3.json("./fourthchartdata.json")
                .then(function (data) {
                  xScale.domain(
                    data.map(function (d) {
                      return (
                        d.AREA +
                        " " +
                        d.TYPE +
                        " " +
                        d.DATATYPE +
                        " " +
                        d.STATUS
                      );
                    })
                  );
                  yScale.domain([
                    0,
                    d3.max(data, function (d) {
                      return parseInt(d.CNT) % 5 == 0
                        ? parseInt(d.CNT)
                        : parseInt(d.CNT) + (5 - (parseInt(d.CNT) % 5));
                    }),
                  ]);

                  g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(
                      // x축: 틱 사이즈 0은 세로 기준 표기선 삭제 함수
                      d3.axisBottom(xScale).tickSize(0)
                    )
                    .selectAll("text") // * 이하 밑부터 x축 라벨링
                    .attr("transform", "translate(0, 5)rotate(-20)")
                    .attr("dy", "1em")
                    .attr("dx", "-0.5em");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 왼쪽 y축 라벨링
                      d3
                        .axisLeft(yScale)
                        .tickSize(-(baseWidth / 2) + 35)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(10)
                    )
                    // y축 라벨링에 관한 라벨링
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 250)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "-5em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "black")
                    .text("건수");

                  g.append("g")
                    .call(
                      // * 이하 밑부터 오른쪽 y축 라벨링
                      d3
                        .axisRight(yScale)
                        .tickSize(baseWidth / 2 - 35)
                        .tickFormat(function (d) {
                          return d;
                        })
                        .ticks(10)
                    )
                    // y축 라벨링 텍스트에 관한 속성들
                    .append("text")
                    .attr("transform", "rotate(0)")
                    .attr("x", height - 300)
                    .attr("y", 6)
                    .attr("dy", "-2.1em")
                    .attr("dx", "45em")
                    .attr("text-anchor", "end")
                    .attr("stroke", "steelblue")
                    .text("평균");

                  // * bar
                  g.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    // .on("mouseover", onMouseOver) //Add listener for the mouseover event
                    // .on("mouseout", onMouseOut) //Add listener for the mouseout event
                    .attr("x", function (d) {
                      return xScale(
                        d.AREA +
                          " " +
                          d.TYPE +
                          " " +
                          d.DATATYPE +
                          " " +
                          d.STATUS
                      );
                    })
                    .attr("y", function (d) {
                      return yScale(d.CNT);
                    })
                    .attr("width", (width = xScale.bandwidth()))
                    .transition()
                    .ease(d3.easeLinear)
                    .duration(200)
                    .delay(function (d, i) {
                      return i * 10;
                    })
                    .attr("height", function (d) {
                      return height - yScale(d.CNT);
                    })
                    .attr("fill", function (d) {
                      // console.log(xGroup);
                      return barColor(data.indexOf(d));
                    });

                  // * line
                  var line = d3
                    .line()
                    .x(function (d) {
                      return (
                        xScale(
                          d.AREA +
                            " " +
                            d.TYPE +
                            " " +
                            d.DATATYPE +
                            " " +
                            d.STATUS
                        ) + 10
                      );
                    })
                    .y(function (d) {
                      return yScale(d.CNT);
                    })
                    .defined(function (d) {
                      return d.DATATYPE;
                    });

                  g.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line)
                    .style("fill", "none")
                    .style("stroke", barColor(4))
                    .attr("stroke-width", 2);

                  g.selectAll("dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("r", function (d) {
                      return 3;
                    })
                    .attr("cx", function (d) {
                      return (
                        xScale(
                          d.AREA +
                            " " +
                            d.TYPE +
                            " " +
                            d.DATATYPE +
                            " " +
                            d.STATUS
                        ) + 10
                      );
                    })
                    .attr("cy", function (d) {
                      return yScale(d.CNT);
                    })
                    .style("fill", barColor(4));
                })
                .catch((e) => console.log(e));
            }
            break;
          default:
            break;
        }
      }

      // * 파이 차트를 그리는 함수
      function drawPieChart(dataType, ChartData, dataTypeArray, typeNum) {
        $("#pie-test").empty();
        var barColor = d3.scaleOrdinal().range(d3.schemeBlues[5]);
        tooltip = d3
          .select("#pie-test")
          .append("div")
          .attr("class", "c3-tooltip-container");

        var baseWidth = $("#pie-test").width();
        baseWidth = baseWidth > 0 ? baseWidth : 900;
        var baseHeight = $("#pie-test").height() - 20;
        baseHeight = baseHeight > 0 ? baseHeight : 500;
        //여백설정
        width = (baseWidth - margin.left - margin.right) / 2;
        height = baseHeight - margin.top - margin.bottom - 150;
        var radius = Math.min(width, height) / 2;

        var svg = d3
          .select("#pie-test")
          .append("svg")
          .attr("width", width * 2)
          .attr("height", height + 150)
          .append("g")
          .attr("transform", "translate(" + width + ", " + height / 2 + ")");

        d3.json("./secondchartdata.json").then(function (data) {
          // * 넘겨받은 data를 d.CNT 기준으로 퍼센테이지를 만들고 배치시켜준다.
          var pie = d3.pie().value(function (d) {
            return d.CNT;
          });
          var readyData = pie(data);
          // console.log(pie(data))

          svg
            .selectAll("pie")
            .data(readyData)
            .enter()
            .append("path")
            .attr("d", d3.arc().innerRadius(100).outerRadius(radius))
            .attr("fill", function (d) {
              return barColor(d.data.id);
            })
            .attr("stroke", "white")
            .attr("id", function (d) {
              return d.data.id;
            })
            .style("stroke-width", "1px")
            .style("opacity", 0.7)
            .on("mouseover", onMouseOverPie)
            .on("mouseout", onMouseOutPie)
            .transition()
            .delay(function (d, i) {
              return i * 200;
            })
            .duration(200);
        });
      }

      // 체크박스 클릭 시 연도 통일/분리하는 함수
      function updateThirdChart() {
        var check = document.getElementById("except-year");
        // * check가 true면 연도 미포함이므로 none 붙임
        // * check가 false면 연도 포함이므로 none 붙임
        if (check.checked) drawChart("third-chart", null, "none");
        else drawChart("third-chart", null);
      }

      // mouseover event handler function
      function onMouseOver(d, i, n) {
        // d: bar chart를 그리기 위해 베이스로 쓰인 데이터
        // console.log(d)
        d3.select(this).attr("class", "highlight");

        var dataTitle = d.id == undefined ? d[0].MODELCODE : d.id;
        var dataContent = d.CNT;
        if (dataContent == undefined) {
          if (d[0].CNT != undefined) {
            dataContent = 0;
            for (var i = 0; i < d.length; i++) {
              dataContent += parseInt(d[i].CNT);
            }
          } else {
            dataContent = 0;
          }
        }
        var dataInfo =
          '<table class = "c3-tooltip"><tbody><tr><th colspan="2> <i class = ""></i>' +
          "Data " +
          dataTitle +
          "</th></tr>" +
          "<tr><td>건수: " +
          dataContent +
          "</td></tr>" +
          "</tbody></table>";
        tooltip.html(dataInfo);
        tooltip
          .style("left", d3.event.pageX + 10 + "px")
          .style("top", d3.event.pageY - 25 + "px")
          .style("display", "inline-block");
      }

      function onMouseOverPie(d, i) {
        var radius = Math.min(width, height) / 2;
        d3.select(this).attr("class", "highlight");
        // .attr("d", d3.arc()
        //   .innerRadius(160)
        //   .outerRadius(radius*10)
        // )
        // console.log(d3.select(this).attr("id"));
        // console.log(d3.event.path[0])
        var dataInfo =
          '<table class = "c3-tooltip"><tbody><tr><th colspan="2> <i class = ""></i>' +
          d.data.YYYY +
          "년 " +
          d.data.MM +
          "월" +
          "</th></tr>" +
          "<tr><td>타입: " +
          d.data.TYPE +
          "</td></tr>" +
          "<tr><td>건수: " +
          d.data.CNT +
          "</td></tr>" +
          "</tbody></table>";

        tooltip
          .style("left", d3.event.pageX + 10 + "px")
          .style("top", d3.event.pageY - 25 + "px")
          .style("display", "inline-block")
          .html(dataInfo);
      }

      //mouseout event handler function
      function onMouseOut(d, i) {
        // use the text label class to remove label on mouseout
        d3.select(this).attr("class", "bar");
        tooltip.style("display", "none");
      }

      function onMouseOutPie(d, i) {
        var radius = Math.min(width, height) / 2;
        d3.select(this).attr("class", "highlight");
        // .attr("d", d3.arc()
        //   .innerRadius(150)
        //   .outerRadius(radius*9)
        // )
        d3.select(this).attr("class", "bar");
        tooltip.style("display", "none");
      }
    </script>
  </body>
</html>
